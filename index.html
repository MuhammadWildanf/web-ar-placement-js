<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Web AR Furniture</title>
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <script>
      // Komponen untuk rotasi objek
      AFRAME.registerComponent("rotate-object", {
        schema: {
          rotateSpeed: { type: "number", default: 1 }
        },
        init: function () {
          this.dragging = false;
          this.startX = 0;
          this.rotationY = 0;
          const sceneEl = this.el.sceneEl;
          const degToRad = THREE.MathUtils.degToRad;

          const onStart = (x) => {
            this.dragging = true;
            this.startX = x;
          };

          const onMove = (x) => {
            if (!this.dragging) return;
            const deltaX = x - this.startX;
            this.rotationY += deltaX * this.data.rotateSpeed;
            this.el.object3D.rotation.y = degToRad(this.rotationY);
            this.startX = x;
          };

          const onEnd = () => {
            this.dragging = false;
          };

          // Mouse events
          sceneEl.addEventListener("mousedown", (e) => {
            if (e.button === 0) { // Left click for rotation
              onStart(e.screenX);
            }
          });
          sceneEl.addEventListener("mousemove", (e) => {
            if (this.dragging) {
              onMove(e.screenX);
            }
          });
          sceneEl.addEventListener("mouseup", onEnd);

          // Touch events
          sceneEl.addEventListener("touchstart", (e) => {
            if (e.touches.length === 1) {
              onStart(e.touches[0].screenX);
            }
          });
          sceneEl.addEventListener("touchmove", (e) => {
            if (e.touches.length === 1 && this.dragging) {
              onMove(e.touches[0].screenX);
            }
          });
          sceneEl.addEventListener("touchend", onEnd);
        }
      });

      // Komponen untuk perpindahan objek
      AFRAME.registerComponent("move-object", {
        schema: {
          moveSpeed: { type: "number", default: 0.005 }
        },
        init: function () {
          this.dragging = false;
          this.startX = 0;
          this.startY = 0;
          this.position = this.el.object3D.position;
          const sceneEl = this.el.sceneEl;

          const onStart = (x, y) => {
            this.dragging = true;
            this.startX = x;
            this.startY = y;
          };

          const onMove = (x, y) => {
            if (!this.dragging) return;
            const deltaX = x - this.startX;
            const deltaY = y - this.startY;

            this.position.x += deltaX * this.data.moveSpeed;
            this.position.z += deltaY * this.data.moveSpeed;

            this.startX = x;
            this.startY = y;
          };

          const onEnd = () => {
            this.dragging = false;
          };

          // Mouse events
          sceneEl.addEventListener("mousedown", (e) => {
            if (e.button === 2) { // Right click for movement
              onStart(e.screenX, e.screenY);
            }
          });
          sceneEl.addEventListener("mousemove", (e) => {
            if (this.dragging) {
              onMove(e.screenX, e.screenY);
            }
          });
          sceneEl.addEventListener("mouseup", onEnd);

          // Touch events - menggunakan dua jari untuk perpindahan
          sceneEl.addEventListener("touchstart", (e) => {
            if (e.touches.length === 2) {
              onStart(e.touches[0].screenX, e.touches[0].screenY);
            }
          });
          sceneEl.addEventListener("touchmove", (e) => {
            if (e.touches.length === 2 && this.dragging) {
              onMove(e.touches[0].screenX, e.touches[0].screenY);
            }
          });
          sceneEl.addEventListener("touchend", onEnd);
        }
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item id="kursi" src="model/kursi.glb"></a-asset-item>
      </a-assets>

      <a-entity 
        gltf-model="#kursi" 
        position="0 0 -2" 
        scale="0.5 0.5 0.5" 
        rotate-object="rotateSpeed: 0.5"
        move-object="moveSpeed: 0.005">
      </a-entity>

      <a-camera position="0 0 0" look-controls></a-camera>
    </a-scene>
  </body>
</html>
