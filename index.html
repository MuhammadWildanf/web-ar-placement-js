<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Web AR Furniture</title>
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      .control-buttons {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
        display: flex;
        gap: 10px;
      }
      .control-button {
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      .control-button.active {
        background-color: #4CAF50;
      }
    </style>
    <script>
      // Komponen untuk rotasi objek
      AFRAME.registerComponent("rotate-object", {
        schema: {
          rotateSpeed: { type: "number", default: 1 },
          enabled: { type: "boolean", default: false }
        },
        init: function () {
          this.dragging = false;
          this.startX = 0;
          this.rotationY = 0;
          const sceneEl = this.el.sceneEl;
          const degToRad = THREE.MathUtils.degToRad;

          const onStart = (x) => {
            if (!this.data.enabled) return;
            this.dragging = true;
            this.startX = x;
          };

          const onMove = (x) => {
            if (!this.dragging || !this.data.enabled) return;
            const deltaX = x - this.startX;
            this.rotationY += deltaX * this.data.rotateSpeed;
            this.el.object3D.rotation.y = degToRad(this.rotationY);
            this.startX = x;
          };

          const onEnd = () => {
            this.dragging = false;
          };

          // Mouse events
          sceneEl.addEventListener("mousedown", (e) => {
            onStart(e.screenX);
          });
          sceneEl.addEventListener("mousemove", (e) => {
            onMove(e.screenX);
          });
          sceneEl.addEventListener("mouseup", onEnd);

          // Touch events
          sceneEl.addEventListener("touchstart", (e) => {
            if (e.touches.length === 1) {
              onStart(e.touches[0].screenX);
            }
          });
          sceneEl.addEventListener("touchmove", (e) => {
            if (e.touches.length === 1) {
              onMove(e.touches[0].screenX);
            }
          });
          sceneEl.addEventListener("touchend", onEnd);
        }
      });

      // Komponen untuk perpindahan objek
      AFRAME.registerComponent("move-object", {
        schema: {
          moveSpeed: { type: "number", default: 0.005 },
          enabled: { type: "boolean", default: false }
        },
        init: function () {
          this.dragging = false;
          this.startX = 0;
          this.startY = 0;
          this.position = this.el.object3D.position;
          const sceneEl = this.el.sceneEl;

          const onStart = (x, y) => {
            if (!this.data.enabled) return;
            this.dragging = true;
            this.startX = x;
            this.startY = y;
          };

          const onMove = (x, y) => {
            if (!this.dragging || !this.data.enabled) return;
            const deltaX = x - this.startX;
            const deltaY = y - this.startY;

            this.position.x += deltaX * this.data.moveSpeed;
            this.position.z += deltaY * this.data.moveSpeed;

            this.startX = x;
            this.startY = y;
          };

          const onEnd = () => {
            this.dragging = false;
          };

          // Mouse events
          sceneEl.addEventListener("mousedown", (e) => {
            onStart(e.screenX, e.screenY);
          });
          sceneEl.addEventListener("mousemove", (e) => {
            onMove(e.screenX, e.screenY);
          });
          sceneEl.addEventListener("mouseup", onEnd);

          // Touch events
          sceneEl.addEventListener("touchstart", (e) => {
            if (e.touches.length === 1) {
              onStart(e.touches[0].screenX, e.touches[0].screenY);
            }
          });
          sceneEl.addEventListener("touchmove", (e) => {
            if (e.touches.length === 1) {
              onMove(e.touches[0].screenX, e.touches[0].screenY);
            }
          });
          sceneEl.addEventListener("touchend", onEnd);
        }
      });

      // Komponen untuk deteksi permukaan
      AFRAME.registerComponent("surface-detection", {
        init: function () {
          this.el.addEventListener("markerFound", () => {
            console.log("Marker ditemukan!");
          });
          this.el.addEventListener("markerLost", () => {
            console.log("Marker hilang!");
          });
        }
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item id="kursi" src="model/kursi.glb"></a-asset-item>
      </a-assets>

      <!-- Marker untuk deteksi permukaan -->
      <a-marker preset="hiro" surface-detection>
        <a-entity 
          gltf-model="#kursi" 
          position="0 0 0" 
          scale="0.5 0.5 0.5" 
          rotate-object="rotateSpeed: 0.5; enabled: false"
          move-object="moveSpeed: 0.005; enabled: false">
        </a-entity>
      </a-marker>

      <a-camera position="0 0 0" look-controls></a-camera>
    </a-scene>

    <!-- Tombol kontrol -->
    <div class="control-buttons">
      <button id="rotateButton" class="control-button">Rotasi</button>
      <button id="moveButton" class="control-button">Pindah</button>
    </div>

    <script>
      // Mengatur tombol kontrol
      const rotateButton = document.getElementById('rotateButton');
      const moveButton = document.getElementById('moveButton');
      const entity = document.querySelector('a-entity');

      rotateButton.addEventListener('click', () => {
        entity.setAttribute('rotate-object', 'enabled', true);
        entity.setAttribute('move-object', 'enabled', false);
        rotateButton.classList.add('active');
        moveButton.classList.remove('active');
      });

      moveButton.addEventListener('click', () => {
        entity.setAttribute('rotate-object', 'enabled', false);
        entity.setAttribute('move-object', 'enabled', true);
        moveButton.classList.add('active');
        rotateButton.classList.remove('active');
      });
    </script>
  </body>
</html>
